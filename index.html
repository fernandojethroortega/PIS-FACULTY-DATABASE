<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Pagudpud Integrated School - Faculty Database</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #fff8e7;
      margin: 0;
      padding: 0;
    }

    header {
      text-align: center;
      background-color: #ffb703;
      color: #0d3b66;
      padding: 25px 0;
      box-shadow: 0 3px 8px rgba(0,0,0,0.2);
    }

    header img {
      width: 180px;
      height: auto;
      display: block;
      margin: 0 auto 10px;
      border-radius: 50%;
      object-fit: contain;
    }

    h1 { margin: 5px 0; font-size: 30px; font-weight: bold; }
    header p { font-size: 18px; font-weight: 500; margin:0; }

    #searchBar {
      display: block;
      margin: 20px auto;
      padding: 10px;
      width: 50%;
      border: 2px solid #0d3b66;
      border-radius: 8px;
      font-size: 16px;
    }

    .actions {
      width: 90%;
      margin: 10px auto;
      display: flex;
      gap: 10px;
      justify-content: flex-end;
    }

    .actions button {
      background-color: #0d3b66;
      color: white;
      border: none;
      padding: 8px 14px;
      border-radius: 8px;
      font-size: 14px;
      cursor: pointer;
    }

    .actions button.secondary {
      background-color: #ffb703;
      color: #0d3b66;
    }

    .actions button:hover { opacity: 0.95; }

    table {
      width: 90%;
      margin: 6px auto 30px;
      border-collapse: collapse;
      text-align: left;
      background: #ffffff;
      box-shadow: 0 3px 8px rgba(0,0,0,0.1);
    }

    th, td {
      border: 1px solid #ccc;
      padding: 10px;
      vertical-align: top;
    }

    th { background-color: #0d3b66; color: white; }
    tr:hover { background-color: #f1f1f1; }

    .details {
      display: none;
      background-color: #f8f8f8;
      padding: 8px;
      border: 1px solid #ddd;
      margin-top:8px;
      border-radius:6px;
    }

    .dropdown-btn {
      background-color: #ffb703;
      color: #0d3b66;
      padding: 6px 10px;
      border-radius: 6px;
      border: none;
      cursor: pointer;
      font-size: 13px;
    }

    #overlay {
      display: none;
      position: fixed;
      top:0; left:0;
      width:100%; height:100%;
      background: rgba(0,0,0,0.5);
      z-index: 999;
    }

    #addForm {
      display: none;
      width: 400px;
      background-color: #fff;
      border: 2px solid #0d3b66;
      border-radius: 10px;
      padding: 18px;
      position: fixed;
      top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      box-shadow: 0 4px 14px rgba(0,0,0,0.35);
      z-index: 1000;
    }

    #addForm h3 { margin-top:0; color:#0d3b66; }
    #addForm input, #addForm select, #addForm textarea {
      width: 100%; padding: 8px; margin: 6px 0; border: 1px solid #ccc; border-radius: 6px;
    }

    #addForm .row { display:flex; gap:8px; }
    #addForm .row input, #addForm .row select { flex:1; }

    @media (max-width:720px) {
      #searchBar { width: 90%; }
      .actions { width: 90%; justify-content: center; }
      table { width: 98%; }
      header img { width: 120px; }
    }
  </style>
</head>
<body>

  <!-- HEADER -->
  <header>
    <img src="PIS OFFICIAL SEAL.png" alt="School Logo">
    <h1>Pagudpud Integrated School Faculty Database</h1>
    <p>City of San Fernando, La Union</p>
  </header>

  <!-- SEARCH -->
  <input type="text" id="searchBar" onkeyup="searchFaculty()" placeholder="Search teacher name, position, specialization, or email...">

  <!-- ACTION BUTTONS -->
  <div class="actions">
    <button onclick="openForm()">Add Teacher</button>
    <button class="secondary" onclick="exportToExcel()">Export to Excel (.xls)</button>
    <button class="secondary" onclick="exportToCSV()">Export CSV</button>
  </div>

  <!-- FACULTY TABLE -->
  <table id="facultyTable">
    <thead>
      <tr>
        <th>#</th>
        <th>Full Name</th>
        <th>Position</th>
        <th>Employee No.</th>
        <th>Specialization</th>
        <th>Details</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <!-- POPUP FORM -->
  <div id="overlay" onclick="closeForm()"></div>
  <div id="addForm" role="dialog" aria-modal="true">
    <h3>Add New Teacher</h3>

    <div class="row">
      <input type="text" id="f_fname" placeholder="First Name *">
      <input type="text" id="f_mname" placeholder="Middle Name">
    </div>
    <input type="text" id="f_lname" placeholder="Last Name *">
    <input type="text" id="f_position" placeholder="Position *">
    <input type="text" id="f_empnum" placeholder="Employee Number *">

    <div class="row">
      <select id="f_sex">
        <option value="">Sex</option>
        <option value="Male">Male</option>
        <option value="Female">Female</option>
      </select>
      <input type="number" id="f_age" placeholder="Age">
    </div>

    <input type="text" id="f_address" placeholder="Address">
    <input type="text" id="f_contact" placeholder="Contact Number">
    <input type="email" id="f_email" placeholder="Email Address">
    <input type="text" id="f_special" placeholder="Specialization">

    <div style="display:flex; gap:8px; justify-content:flex-end; margin-top:8px;">
      <button onclick="addTeacher()">Add</button>
      <button style="background:#ddd;color:#0d3b66;" onclick="closeForm()">Cancel</button>
    </div>
  </div>

  <script>
    const STORAGE_KEY = 'pis_faculty_data_v2';
    let facultyData = loadData();

    function loadData() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        return raw ? JSON.parse(raw) : [];
      } catch {
        return [];
      }
    }

    function saveData() {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(facultyData));
    }

    function renderTable(filtered = null) {
      const tbody = document.querySelector('#facultyTable tbody');
      tbody.innerHTML = '';
      const list = filtered ?? facultyData;
      list.forEach((f, i) => {
        const detailsId = 'details-' + (i+1) + '-' + Date.now();
        const fullname = `${f.fname} ${f.mname ? f.mname + ' ' : ''}${f.lname}`;
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${i + 1}</td>
          <td>${fullname}</td>
          <td>${f.position}</td>
          <td>${f.empnum}</td>
          <td>${f.special}</td>
          <td>
            <button class="dropdown-btn" onclick="toggleDetails('${detailsId}', this)">Show</button>
            <div id="${detailsId}" class="details">
              <p><strong>Sex:</strong> ${f.sex || ''}</p>
              <p><strong>Age:</strong> ${f.age || ''}</p>
              <p><strong>Address:</strong> ${f.address || ''}</p>
              <p><strong>Contact:</strong> ${f.contact || ''}</p>
              <p><strong>Email:</strong> ${f.email || ''}</p>
              <div style="margin-top:6px;">
                <button onclick="editTeacher(${i})">Edit</button>
                <button onclick="deleteTeacher(${i})" style="background:#e74c3c;">Delete</button>
              </div>
            </div>
          </td>`;
        tbody.appendChild(row);
      });
    }

    function searchFaculty() {
      const q = document.getElementById('searchBar').value.trim().toLowerCase();
      if (!q) { renderTable(); return; }
      const filtered = facultyData.filter(f =>
        (f.fname+f.mname+f.lname).toLowerCase().includes(q) ||
        (f.position||'').toLowerCase().includes(q) ||
        (f.special||'').toLowerCase().includes(q) ||
        (f.email||'').toLowerCase().includes(q)
      );
      renderTable(filtered);
    }

    function toggleDetails(id, btn) {
      const el = document.getElementById(id);
      if (el.style.display === 'block') {
        el.style.display = 'none';
        btn.textContent = 'Show';
      } else {
        el.style.display = 'block';
        btn.textContent = 'Hide';
      }
    }

    function openForm() {
      document.getElementById('overlay').style.display = 'block';
      document.getElementById('addForm').style.display = 'block';
      document.querySelectorAll('#addForm input, #addForm select').forEach(i => i.value = '');
      document.getElementById('addForm').dataset.mode = 'add';
      document.getElementById('addForm').dataset.index = '';
    }

    function closeForm() {
      document.getElementById('overlay').style.display = 'none';
      document.getElementById('addForm').style.display = 'none';
    }

    function addTeacher() {
      const f = {
        fname: document.getElementById('f_fname').value.trim(),
        mname: document.getElementById('f_mname').value.trim(),
        lname: document.getElementById('f_lname').value.trim(),
        position: document.getElementById('f_position').value.trim(),
        empnum: document.getElementById('f_empnum').value.trim(),
        sex: document.getElementById('f_sex').value.trim(),
        age: document.getElementById('f_age').value.trim(),
        address: document.getElementById('f_address').value.trim(),
        contact: document.getElementById('f_contact').value.trim(),
        email: document.getElementById('f_email').value.trim(),
        special: document.getElementById('f_special').value.trim()
      };

      if (!f.fname || !f.lname || !f.position || !f.empnum) {
        alert('Please complete required fields.');
        return;
      }

      const mode = document.getElementById('addForm').dataset.mode;
      const idx = document.getElementById('addForm').dataset.index;
      if (mode === 'edit' && idx !== '') facultyData[idx] = f;
      else facultyData.push(f);
      saveData();
      renderTable();
      closeForm();
    }

    function editTeacher(index) {
      const f = facultyData[index];
      openForm();
      document.getElementById('f_fname').value = f.fname;
      document.getElementById('f_mname').value = f.mname;
      document.getElementById('f_lname').value = f.lname;
      document.getElementById('f_position').value = f.position;
      document.getElementById('f_empnum').value = f.empnum;
      document.getElementById('f_sex').value = f.sex;
      document.getElementById('f_age').value = f.age;
      document.getElementById('f_address').value = f.address;
      document.getElementById('f_contact').value = f.contact;
      document.getElementById('f_email').value = f.email;
      document.getElementById('f_special').value = f.special;
      document.getElementById('addForm').dataset.mode = 'edit';
      document.getElementById('addForm').dataset.index = index;
    }

    function deleteTeacher(i) {
      if (!confirm('Delete this teacher?')) return;
      facultyData.splice(i, 1);
      saveData();
      renderTable();
    }

    function exportToExcel() {
      if (facultyData.length === 0) return alert('No data to export.');
      let html = '<table><thead><tr><th>#</th><th>First Name</th><th>Middle Name</th><th>Last Name</th><th>Position</th><th>Employee No.</th><th>Sex</th><th>Age</th><th>Address</th><th>Contact</th><th>Email</th><th>Specialization</th></tr></thead><tbody>';
      facultyData.forEach((f,i) => {
        html += `<tr><td>${i+1}</td><td>${f.fname}</td><td>${f.mname}</td><td>${f.lname}</td><td>${f.position}</td><td>${f.empnum}</td><td>${f.sex}</td><td>${f.age}</td><td>${f.address}</td><td>${f.contact}</td><td>${f.email}</td><td>${f.special}</td></tr>`;
      });
      html += '</tbody></table>';
      const blob = new Blob(['\ufeff', html], {type:'application/vnd.ms-excel'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'Faculty_Data.xls';
      a.click();
      URL.revokeObjectURL(url);
    }

    function exportToCSV() {
      if (facultyData.length === 0) return alert('No data to export.');
      const headers = ['#','First Name','Middle Name','Last Name','Position','Employee No.','Sex','Age','Address','Contact','Email','Specialization'];
      const rows = [headers];
      facultyData.forEach((f,i) => {
        rows.push([i+1,f.fname,f.mname,f.lname,f.position,f.empnum,f.sex,f.age,f.address,f.contact,f.email,f.special]);
      });
      const csv = rows.map(r => r.map(c => `"${String(c||'').replace(/"/g,'""')}"`).join(',')).join('\r\n');
      const blob = new Blob(['\ufeff', csv], {type:'text/csv;charset=utf-8;'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'Faculty_Data.csv';
      a.click();
      URL.revokeObjectURL(url);
    }

    renderTable();
    window.addEventListener('keydown', e => { if (e.key === 'Escape') closeForm(); });
  </script>
</body>
</html>
