<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Pagudpud Integrated School - Faculty Dashboard</title>
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
<style>
:root { --blue:#0d3b66; --gold:#ffb703; --bg:#fff8e7; }
body { font-family:"Segoe UI", Tahoma, Geneva, Verdana, sans-serif; margin:0; background:var(--bg); }
header { background:var(--blue); color:#fff; padding:15px 20px; text-align:center; font-size:1.4rem; position:relative; }
#clock { position:absolute; top:8px; left:15px; font-size:0.9rem; }
main { padding:20px; }
.search-bar { margin-bottom:20px; text-align:center; }
input[type="text"] { padding:10px; width:320px; border-radius:8px; border:1px solid #ccc; }
.teacher-grid { display:grid; grid-template-columns:repeat(auto-fill, minmax(250px,1fr)); gap:15px; }
.teacher-card { background:#fff; border-radius:12px; padding:15px; box-shadow:0 2px 6px rgba(0,0,0,0.1); text-align:center; }
.teacher-photo { width:100px; height:100px; object-fit:cover; border-radius:50%; border:3px solid var(--gold); margin-bottom:10px; }
.teacher-name { font-weight:bold; color:var(--blue); font-size:1.05rem; }
.teacher-info { font-size:0.9rem; color:#333; margin-top:6px; }
button { background:var(--blue); color:#fff; border:none; padding:6px 12px; border-radius:6px; cursor:pointer; margin:3px; }
button:hover { background:var(--gold); color:var(--blue); }
.modal { display:none; position:fixed; left:0; top:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:20; overflow:auto; }
.modal-content { background:#fff; margin:6% auto; padding:20px; width:650px; border-radius:10px; }
.close { float:right; color:red; cursor:pointer; font-size:1.2rem; }
table { border-collapse:collapse; width:100%; }
th, td { padding:6px 8px; text-align:left; border:1px solid #ccc; font-size:0.9rem; }
th { background:var(--blue); color:#fff; }
input, select { padding:6px; margin:4px; border-radius:6px; border:1px solid #ccc; width:95%; }
</style>
</head>
<body>

<header>
  <div id="clock"></div>
  PAGUDPUD INTEGRATED SCHOOL â€” FACULTY DASHBOARD
</header>

<main>
  <div class="search-bar">
    <input id="searchInput" type="text" placeholder="Search teacher..." oninput="searchTeacher()">
  </div>
  <div id="teacherContainer" class="teacher-grid"></div>
</main>

<!-- View Teacher Modal -->
<div id="viewModal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="closeModal()">&times;</span>
    <h3>Teacher Information</h3>
    <p><strong>Full Name:</strong> <span id="vFullName"></span></p>
    <p><strong>Position:</strong> <span id="vPosition"></span></p>
    <p><strong>Employee No.:</strong> <span id="vEmpNo"></span></p>
    <p><strong>Sex:</strong> <span id="vSex"></span></p>
    <p><strong>Age:</strong> <span id="vAge"></span></p>
    <p><strong>Address:</strong> <span id="vAddress"></span></p>
    <p><strong>Specialization:</strong> <span id="vSpec"></span></p>
    <p><strong>Email:</strong> <span id="vEmail"></span></p>
    <p><strong>Contact No.:</strong> <span id="vContact"></span></p>
  </div>
</div>

<!-- View Schedule Modal -->
<div id="scheduleModal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="closeScheduleModal()">&times;</span>
    <h3>Schedule for <span id="scheduleTeacherName"></span></h3>
    <button onclick="showAddScheduleForm()">Add Schedule</button>
    <table id="scheduleTable">
      <thead>
        <tr>
          <th>DAY</th>
          <th>SUBJECT</th>
          <th>START TIME</th>
          <th>END TIME</th>
          <th>GRADE LEVEL & SECTION</th>
          <th>ROOM</th>
          <th>ACTION</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <!-- Add/Edit Schedule Form -->
    <div id="addScheduleForm" style="display:none; margin-top:15px;">
      <h4 id="formTitle">Add Schedule Entry</h4>
      <label>Day:</label>
      <select id="dayInput">
        <option value="">Select Day</option>
        <option>Monday</option>
        <option>Tuesday</option>
        <option>Wednesday</option>
        <option>Thursday</option>
        <option>Friday</option>
        <option>Saturday</option>
        <option>Sunday</option>
      </select><br>
      <label>Subject:</label><input id="subjectInput" type="text" placeholder="Enter Subject"><br>
      <label>Start Time:</label><input id="startInput" type="time" placeholder="Start Time"><br>
      <label>End Time:</label><input id="endInput" type="time" placeholder="End Time"><br>
      <label>Grade Level & Section:</label><input id="gradeInput" type="text" placeholder="Ex: Grade 10 - Rizal"><br>
      <label>Room:</label><input id="roomInput" type="text" placeholder="Ex: Room 201"><br>
      <button onclick="saveSchedule()">Save</button>
      <button onclick="cancelAddSchedule()">Cancel</button>
    </div>
  </div>
</div>

<script>
/* Clock */
function updateClock(){ document.getElementById('clock').textContent = new Date().toLocaleTimeString(); }
setInterval(updateClock,1000); updateClock();

/* Local Storage */
let savedPhotos = JSON.parse(localStorage.getItem('teacherPhotos') || '{}');
let savedSchedules = JSON.parse(localStorage.getItem('teacherSchedules') || '{}');
let teacherData = [];
let currentTeacherId = null;
let editingIndex = null;

/* Load Teachers */
async function loadTeacherData(){
  const fileUrl = "https://docs.google.com/spreadsheets/d/1FJl1WywegQhwYHdAv_nf4ZmNrEI63sJfdP_83lD8lfk/export?format=csv";
  try {
    const res = await fetch(fileUrl);
    const csv = await res.text();
    const wb = XLSX.read(csv, {type:'string'});
    const sheet = wb.Sheets[wb.SheetNames[0]];
    const raw = XLSX.utils.sheet_to_json(sheet, {defval:''});

    teacherData = raw.map(row => {
      const norm = {};
      for (const k in row) norm[k.trim().toLowerCase()] = row[k];
      const id = (norm['employee number'] || norm['emp no'] || Math.random().toString(36).slice(2,9)).toString();
      return { id, row: norm, photo: savedPhotos[id] || '', schedule: savedSchedules[id] || [] };
    });
    renderCards(teacherData);
  } catch (err) { console.error(err); }
}

/* Render Teachers */
function renderCards(list){
  const container = document.getElementById('teacherContainer');
  container.innerHTML = '';
  list.forEach(t => {
    const name = `${t.row['first name']||''} ${t.row['middle name']||''} ${t.row['last name']||''}`;
    const photo = t.photo || 'https://via.placeholder.com/100?text=No+Photo';
    const card = document.createElement('div');
    card.className = 'teacher-card';
    card.innerHTML = `
      <img src="${photo}" class="teacher-photo">
      <div class="teacher-name">${name}</div>
      <div class="teacher-info">${t.row['position']||''}</div>
      <button onclick="viewTeacher('${t.id}')">View</button>
      <button onclick="viewSchedule('${t.id}')">View Schedule</button>`;
    container.appendChild(card);
  });
}

/* View Teacher */
function viewTeacher(id){
  const t = teacherData.find(x => x.id === id);
  if(!t) return;
  const r = t.row;
  document.getElementById('vFullName').textContent = `${r['first name']||''} ${r['middle name']||''} ${r['last name']||''}`;
  document.getElementById('vPosition').textContent = r['position']||'';
  document.getElementById('vEmpNo').textContent = t.id;
  document.getElementById('vSex').textContent = r['sex']||'';
  document.getElementById('vAge').textContent = r['age']||'';
  document.getElementById('vAddress').textContent = r['address']||'';
  document.getElementById('vSpec').textContent = r['specialization']||'';
  document.getElementById('vEmail').textContent = r['email']||'';
  document.getElementById('vContact').textContent = r['contact number']||'';
  document.getElementById('viewModal').style.display = 'block';
}
function closeModal(){ document.getElementById('viewModal').style.display = 'none'; }

/* Schedule Modal */
function viewSchedule(id){
  currentTeacherId = id;
  const t = teacherData.find(x => x.id === id);
  if(!t) return;
  document.getElementById('scheduleTeacherName').textContent = `${t.row['first name']} ${t.row['last name']}`;
  renderScheduleTable(t.schedule);
  document.getElementById('scheduleModal').style.display = 'block';
}
function closeScheduleModal(){ document.getElementById('scheduleModal').style.display = 'none'; }

function renderScheduleTable(list){
  const tbody = document.querySelector('#scheduleTable tbody');
  tbody.innerHTML = '';
  list.forEach((s, i) => {
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${s.day}</td>
      <td>${s.subject}</td>
      <td>${s.start}</td>
      <td>${s.end}</td>
      <td>${s.grade}</td>
      <td>${s.room}</td>
      <td>
        <button onclick="editSchedule(${i})">Edit</button>
        <button onclick="deleteSchedule(${i})">Delete</button>
      </td>`;
    tbody.appendChild(tr);
  });
}

/* Add/Edit Schedule */
function showAddScheduleForm(){
  document.getElementById('addScheduleForm').style.display = 'block';
  document.getElementById('formTitle').textContent = 'Add Schedule Entry';
  editingIndex = null;
}
function cancelAddSchedule(){
  document.getElementById('addScheduleForm').style.display = 'none';
  clearForm();
}
function clearForm(){
  ['dayInput','subjectInput','startInput','endInput','gradeInput','roomInput'].forEach(id => document.getElementById(id).value = '');
}
function saveSchedule(){
  const t = teacherData.find(x => x.id === currentTeacherId);
  if(!t) return;
  const entry = {
    day: document.getElementById('dayInput').value,
    subject: document.getElementById('subjectInput').value,
    start: document.getElementById('startInput').value,
    end: document.getElementById('endInput').value,
    grade: document.getElementById('gradeInput').value,
    room: document.getElementById('roomInput').value
  };
  if(editingIndex !== null) t.schedule[editingIndex] = entry;
  else t.schedule.push(entry);
  savedSchedules[currentTeacherId] = t.schedule;
  localStorage.setItem('teacherSchedules', JSON.stringify(savedSchedules));
  renderScheduleTable(t.schedule);
  cancelAddSchedule();
}
function editSchedule(index){
  const t = teacherData.find(x => x.id === currentTeacherId);
  if(!t) return;
  const s = t.schedule[index];
  document.getElementById('dayInput').value = s.day;
  document.getElementById('subjectInput').value = s.subject;
  document.getElementById('startInput').value = s.start;
  document.getElementById('endInput').value = s.end;
  document.getElementById('gradeInput').value = s.grade;
  document.getElementById('roomInput').value = s.room;
  document.getElementById('addScheduleForm').style.display = 'block';
  document.getElementById('formTitle').textContent = 'Edit Schedule Entry';
  editingIndex = index;
}
function deleteSchedule(index){
  const t = teacherData.find(x => x.id === currentTeacherId);
  if(!t) return;
  if(confirm('Are you sure you want to delete this schedule?')){
    t.schedule.splice(index,1);
    savedSchedules[currentTeacherId] = t.schedule;
    localStorage.setItem('teacherSchedules', JSON.stringify(savedSchedules));
    renderScheduleTable(t.schedule);
  }
}

/* Search */
function searchTeacher(){
  const q = document.getElementById('searchInput').value.toLowerCase();
  if(!q){ renderCards(teacherData); return; }
  const filtered = teacherData.filter(t => Object.values(t.row).join(' ').toLowerCase().includes(q));
  renderCards(filtered);
}

/* Init */
loadTeacherData();
</script>

</body>
</html>
