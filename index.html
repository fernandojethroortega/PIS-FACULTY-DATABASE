<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Pagudpud Integrated School - Faculty & Schedule</title>
<style>
  :root {
    --blue:#0d3b66;
    --gold:#ffb703;
    --bg:#fff8e7;
  }
  body{font-family:Segoe UI, Tahoma, Geneva, Verdana, sans-serif;background:var(--bg);margin:0;padding:0;color:#111}
  header{display:flex;flex-wrap:wrap;align-items:center;justify-content:space-between;background:var(--gold);color:var(--blue);padding:12px 16px;box-shadow:0 3px 8px rgba(0,0,0,.12)}
  .brand{display:flex;align-items:center;gap:12px}
  .brand img{width:72px;height:72px;border-radius:50%;object-fit:contain}
  .brand h1{font-size:18px;margin:0}
  .header-actions{display:flex;gap:8px;align-items:center}
  .icon-btn{background:transparent;border:1px solid rgba(13,59,102,0.15);padding:8px;border-radius:8px;cursor:pointer;display:flex;align-items:center;gap:8px}
  .icon-btn .emoji{font-size:18px}
  #adminLogin{display:flex;gap:6px;align-items:center}
  #adminLogin input{padding:6px;border-radius:6px;border:1px solid #ccc}
  #adminLogin button{background:var(--blue);color:#fff;border:none;padding:6px 10px;border-radius:6px;cursor:pointer}

  main{padding:14px}

  .topbar{display:flex;flex-wrap:wrap;gap:10px;justify-content:space-between;align-items:center;margin-bottom:12px}
  .search{flex:1;min-width:200px;max-width:520px}
  .search input{width:100%;padding:10px;border-radius:8px;border:1px solid #ccc;text-transform:uppercase}

  .controls{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
  .controls button{background:var(--blue);color:#fff;border:none;padding:8px 12px;border-radius:8px;cursor:pointer}
  .controls button.secondary{background:var(--gold);color:var(--blue);border:1px solid var(--blue)}

  table{width:100%;border-collapse:collapse;margin-top:8px;font-size:13px}
  th,td{border:1px solid #ddd;padding:8px;text-align:left;vertical-align:top}
  th{background:var(--gold);color:var(--blue);text-transform:uppercase;font-size:12px}
  td small{display:block;color:#444;font-size:12px;margin-top:6px}
  .actions-cell{display:flex;gap:6px;flex-wrap:wrap}
  .pill{background:#f3f3f3;border-radius:6px;padding:4px 6px;font-size:12px}

  /* Modal */
  .modal{display:none;position:fixed;z-index:999;left:0;top:0;width:100%;height:100%;background:rgba(0,0,0,0.5);overflow:auto}
  .modal .panel{background:#fff;margin:4% auto;padding:14px;border-radius:10px;width:95%;max-width:760px;box-shadow:0 6px 18px rgba(0,0,0,.25)}
  .modal .panel h3{margin:0 0 8px 0;color:var(--blue)}
  .grid{display:grid;grid-template-columns:repeat(2,1fr);gap:8px}
  .grid .full{grid-column:1/3}
  input[type=text], input[type=email], input[type=number], select, textarea, input[type=time], input[type=date] {
    width:100%;padding:8px;border-radius:6px;border:1px solid #ccc;font-size:14px;
  }
  label{font-size:13px;color:#222;margin-top:6px;display:block}
  .small{font-size:12px;color:#555}
  .row-actions{display:flex;gap:8px;margin-top:10px;justify-content:flex-end}

  /* schedule list UI within modal */
  .schedule-list{max-height:180px;overflow:auto;border:1px dashed #ddd;padding:8px;border-radius:6px;background:#fafafa}
  .schedule-item{display:flex;justify-content:space-between;gap:8px;padding:6px;border-bottom:1px solid #eee}
  .schedule-item:last-child{border-bottom:none}

  @media (max-width:720px){
    .grid{grid-template-columns:1fr}
    header{padding:10px}
    .brand h1{font-size:16px}
    .search input{max-width:100%}
    .modal .panel{margin:10% 6%}
    th,td{font-size:12px}
  }
</style>
</head>
<body>

<header>
  <div class="brand">
    <img src="PIS OFFICIAL SEAL.png" alt="logo">
    <div>
      <h1>Pagudpud Integrated School</h1>
      <div class="small">Faculty Database with Live Vacant Detection</div>
    </div>
  </div>

  <div class="header-actions">
    <!-- icons -->
    <button class="icon-btn" title="Vacant Teachers (based on current time)" onclick="openVacantModal()">
      <span class="emoji">‚è≥</span><span>Vacant Teachers</span>
    </button>
    <button class="icon-btn" title="Teacher Schedules" onclick="openSchedulesModal()">
      <span class="emoji">üìÖ</span><span>Teacher's Schedule</span>
    </button>

    <!-- admin login -->
    <div id="adminLogin">
      <input id="adminPass" type="password" placeholder="Admin password">
      <button onclick="adminLogin()">Admin</button>
    </div>
  </div>
</header>

<main>
  <div class="topbar">
    <div class="search"><input id="searchInput" placeholder="Search by name / position / specialization" oninput="renderTableFiltered()"></div>
    <div class="controls">
      <button onclick="triggerAdd()">‚ûï Add Teacher</button>
      <button class="secondary" onclick="exportCSV()">üì§ Export CSV</button>
      <button onclick="clearAllData()">üóëÔ∏è Clear All (Admin)</button>
    </div>
  </div>

  <section>
    <table id="facultyTable" aria-live="polite">
      <thead>
        <tr>
          <th>#</th><th>Full Name</th><th>Position</th><th>Employee No.</th><th>Specialization</th><th>Schedules</th><th>Actions</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </section>
</main>

<!-- Add/Edit Teacher Modal -->
<div id="teacherModal" class="modal" aria-hidden="true">
  <div class="panel" role="dialog" aria-modal="true">
    <h3 id="teacherModalTitle">Add Teacher</h3>
    <div class="grid">
      <div>
        <label>First Name *</label>
        <input id="t_first" type="text" placeholder="FIRST NAME">
      </div>
      <div>
        <label>Middle Name *</label>
        <input id="t_middle" type="text" placeholder="MIDDLE NAME">
      </div>
      <div>
        <label>Last Name *</label>
        <input id="t_last" type="text" placeholder="LAST NAME">
      </div>
      <div>
        <label>Position *</label>
        <input id="t_position" type="text" placeholder="POSITION">
      </div>
      <div>
        <label>Employee Number *</label>
        <input id="t_empno" type="text" placeholder="EMPLOYEE NUMBER">
      </div>
      <div>
        <label>Sex *</label>
        <select id="t_sex"><option value="">Select</option><option>MALE</option><option>FEMALE</option></select>
      </div>
      <div>
        <label>Age *</label>
        <input id="t_age" type="number" min="18" placeholder="AGE">
      </div>
      <div>
        <label>Contact Number *</label>
        <input id="t_contact" type="text" placeholder="CONTACT">
      </div>
      <div class="full">
        <label>Address *</label>
        <input id="t_address" type="text" placeholder="ADDRESS">
      </div>
      <div>
        <label>Email (lowercase) *</label>
        <input id="t_email" type="email" placeholder="email@example.com">
      </div>
      <div>
        <label>Specialization *</label>
        <input id="t_special" type="text" placeholder="SPECIALIZATION">
      </div>

      <!-- Schedule entry area -->
      <div class="full">
        <label>Schedules (Day, Start - End, Subject, Room) ‚Äî Add one by one *</label>
        <div style="display:flex;gap:6px;flex-wrap:wrap;margin-bottom:6px">
          <select id="s_day" style="width:120px">
            <option value="">DAY</option>
            <option>MONDAY</option><option>TUESDAY</option><option>WEDNESDAY</option><option>THURSDAY</option><option>FRIDAY</option><option>SATURDAY</option>
          </select>
          <input id="s_start" type="time" style="width:120px">
          <input id="s_end" type="time" style="width:120px">
          <input id="s_subject" type="text" placeholder="SUBJECT" style="flex:1">
          <input id="s_room" type="text" placeholder="ROOM" style="width:120px">
          <button onclick="addScheduleItem()" style="background:var(--gold);color:var(--blue);border:none;padding:8px;border-radius:6px;cursor:pointer">Add</button>
        </div>
        <div class="schedule-list" id="scheduleList" aria-live="polite"></div>
        <div class="small">Tip: Add all schedule rows for this teacher. Vacant detection uses these schedules.</div>
      </div>

      <div class="full row-actions">
        <button onclick="saveTeacher()">Save</button>
        <button style="background:#ddd;color:var(--blue)" onclick="closeTeacherModal()">Cancel</button>
      </div>
    </div>
  </div>
</div>

<!-- Vacant Teachers Modal -->
<div id="vacantModal" class="modal"><div class="panel"><h3>Vacant Teachers (Now)</h3>
  <div id="vacantList" class="schedule-list"></div>
  <div class="row-actions"><button onclick="closeVacantModal()">Close</button></div>
</div></div>

<!-- Schedules Modal -->
<div id="schedulesModal" class="modal"><div class="panel"><h3>All Teacher Schedules</h3>
  <div id="allSchedules" class="schedule-list"></div>
  <div class="row-actions"><button onclick="closeSchedulesModal()">Close</button></div>
</div></div>

<script>
/* -------------------------
  Data model & persistence
   - faculty: array of teacher objects
   - each teacher: {id, fname,mname,lname,position,empno,sex,age,address,contact,email,special, schedules: [{day,start,end,subject,room}]}
----------------------------*/
const STORAGE_KEY = 'pis_faculty_v3';
let faculty = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');
let adminAccess = false;
let editingIndex = -1;

/* Utility: save to localStorage */
function persist(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(faculty)); }

/* Auto uppercase except email/time */
document.addEventListener('input', e=>{
  const el = e.target;
  if(!el) return;
  if(el.tagName==='INPUT' || el.tagName==='TEXTAREA' || el.tagName==='SELECT'){
    if(el.type === 'email' || el.type === 'time' || el.type==='number' ) return;
    el.value = el.value.toUpperCase();
  }
});

/* Admin login */
function adminLogin(){
  const pw = document.getElementById('adminPass').value;
  if(pw === 'ADMIN123'){ adminAccess = true; alert('Admin access granted'); }
  else { alert('Incorrect password'); }
}

/* Render table */
function renderTableFiltered(){
  const q = (document.getElementById('searchInput').value||'').trim().toUpperCase();
  const tbody = document.querySelector('#facultyTable tbody');
  tbody.innerHTML = '';
  faculty.forEach((t,i)=>{
    const fullname = `${t.fname} ${t.mname} ${t.lname}`.trim();
    if(q && !(fullname.includes(q) || (t.position||'').includes(q) || (t.special||'').includes(q) || (t.empno||'').includes(q))) return;
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${i+1}</td>
      <td><strong>${fullname}</strong><br><small>${t.email || ''}</small></td>
      <td>${t.position}</td>
      <td>${t.empno}</td>
      <td>${t.special}</td>
      <td>${renderScheduleSummary(t.schedules)}</td>
      <td class="actions-cell">
        <button onclick="viewTeacher(${i})">View</button>
        <button onclick="openEdit(${i})">Edit</button>
        <button style="background:#e74c3c" onclick="deleteTeacher(${i})">Delete</button>
      </td>`;
    tbody.appendChild(tr);
  });
}

/* small schedule summary */
function renderScheduleSummary(sched=[]){
  if(!sched || sched.length===0) return '<span class="pill">NO SCHEDULE</span>';
  return sched.slice(0,2).map(s => `<div class="pill">${s.day} ${s.start}-${s.end} ${s.subject} (${s.room})</div>`).join(' ');
}

/* View teacher: opens teacher modal in read-only */
function viewTeacher(i){
  const t = faculty[i];
  openTeacherPanel(t, i, true);
}

/* Open add modal */
function triggerAdd(){
  if(!adminAccess){ alert('Please enter admin password first.'); return; }
  editingIndex = -1; openTeacherModal();
}

/* Open modal and reset */
function openTeacherModal(){
  document.getElementById('teacherModalTitle').innerText = editingIndex===-1 ? 'Add Teacher' : 'Edit Teacher';
  clearTeacherForm();
  document.getElementById('teacherModal').style.display='block';
}

/* Clear form and schedule list */
function clearTeacherForm(){
  ['t_first','t_middle','t_last','t_position','t_empno','t_sex','t_age','t_contact','t_address','t_email','t_special'].forEach(id=>{
    const el = document.getElementById(id);
    if(el) el.value = '';
  });
  document.getElementById('scheduleList').innerHTML = '';
  document.getElementById('s_day').value=''; document.getElementById('s_start').value=''; document.getElementById('s_end').value=''; document.getElementById('s_subject').value=''; document.getElementById('s_room').value='';
}

/* Add schedule item to local UI list (not yet saved) */
function addScheduleItem(){
  const day = document.getElementById('s_day').value;
  const start = document.getElementById('s_start').value;
  const end = document.getElementById('s_end').value;
  const subject = document.getElementById('s_subject').value.trim().toUpperCase();
  const room = document.getElementById('s_room').value.trim().toUpperCase();
  if(!day || !start || !end || !subject || !room){ alert('Please complete schedule entry.'); return; }
  // create UI element
  const li = document.createElement('div'); li.className='schedule-item';
  li.dataset.day = day; li.dataset.start = start; li.dataset.end=end; li.dataset.subject=subject; li.dataset.room=room;
  li.innerHTML = `<div>${day} ${start}-${end} ‚Ä¢ ${subject} ‚Ä¢ ${room}</div><div><button onclick="editScheduleItem(this)">‚úèÔ∏è</button> <button onclick="removeScheduleItem(this)">üóëÔ∏è</button></div>`;
  document.getElementById('scheduleList').appendChild(li);
  // clear inputs
  document.getElementById('s_day').value=''; document.getElementById('s_start').value=''; document.getElementById('s_end').value=''; document.getElementById('s_subject').value=''; document.getElementById('s_room').value='';
}

/* edit schedule UI item */
function editScheduleItem(btn){
  const el = btn.closest('.schedule-item');
  if(!el) return;
  document.getElementById('s_day').value = el.dataset.day;
  document.getElementById('s_start').value = el.dataset.start;
  document.getElementById('s_end').value = el.dataset.end;
  document.getElementById('s_subject').value = el.dataset.subject;
  document.getElementById('s_room').value = el.dataset.room;
  el.remove();
}

/* remove schedule UI item */
function removeScheduleItem(btn){
  const el = btn.closest('.schedule-item'); if(el) el.remove();
}

/* Save teacher from modal */
function saveTeacher(){
  // gather fields
  const t = {
    fname: (document.getElementById('t_first').value||'').trim().toUpperCase(),
    mname: (document.getElementById('t_middle').value||'').trim().toUpperCase(),
    lname: (document.getElementById('t_last').value||'').trim().toUpperCase(),
    position: (document.getElementById('t_position').value||'').trim().toUpperCase(),
    empno: (document.getElementById('t_empno').value||'').trim().toUpperCase(),
    sex: (document.getElementById('t_sex').value||'').trim().toUpperCase(),
    age: (document.getElementById('t_age').value||'').trim(),
    contact: (document.getElementById('t_contact').value||'').trim().toUpperCase(),
    address: (document.getElementById('t_address').value||'').trim().toUpperCase(),
    email: (document.getElementById('t_email').value||'').trim(), // keep email as typed (case-insensitive)
    special: (document.getElementById('t_special').value||'').trim().toUpperCase()
  };
  // require all fields
  for(const k of ['fname','mname','lname','position','empno','sex','age','contact','address','email','special']){
    if(!t[k]){ alert('All fields (including Middle Name) are required.'); return; }
  }
  // collect schedules from UI list
  const schedEls = Array.from(document.querySelectorAll('#scheduleList .schedule-item'));
  if(schedEls.length === 0){ alert('At least one schedule entry is required.'); return; }
  t.schedules = schedEls.map(el => ({ day: el.dataset.day, start: el.dataset.start, end: el.dataset.end, subject: el.dataset.subject, room: el.dataset.room }));
  // save or update
  if(editingIndex>=0){
    faculty[editingIndex] = t;
  } else {
    faculty.push(t);
  }
  persist(); renderTableFiltered(); closeTeacherModal();
}

/* close modal */
function closeTeacherModal(){ document.getElementById('teacherModal').style.display='none'; editingIndex=-1; clearTeacherForm(); }

/* open edit */
function openEdit(i){
  if(!adminAccess){ alert('Admin required to edit'); return; }
  editingIndex = i; openTeacherModal();
  // populate fields
  const t = faculty[i];
  document.getElementById('t_first').value = t.fname; document.getElementById('t_middle').value = t.mname; document.getElementById('t_last').value = t.lname;
  document.getElementById('t_position').value = t.position; document.getElementById('t_empno').value = t.empno; document.getElementById('t_sex').value = t.sex;
  document.getElementById('t_age').value = t.age; document.getElementById('t_contact').value = t.contact; document.getElementById('t_address').value = t.address;
  document.getElementById('t_email').value = t.email; document.getElementById('t_special').value = t.special;
  // populate schedule list
  const list = document.getElementById('scheduleList'); list.innerHTML = '';
  (t.schedules||[]).forEach(s=>{
    const li = document.createElement('div'); li.className='schedule-item';
    li.dataset.day = s.day; li.dataset.start=s.start; li.dataset.end=s.end; li.dataset.subject=s.subject; li.dataset.room=s.room;
    li.innerHTML = `<div>${s.day} ${s.start}-${s.end} ‚Ä¢ ${s.subject} ‚Ä¢ ${s.room}</div><div><button onclick="editScheduleItem(this)">‚úèÔ∏è</button> <button onclick="removeScheduleItem(this)">üóëÔ∏è</button></div>`;
    list.appendChild(li);
  });
}

/* delete teacher */
function deleteTeacher(i){
  if(!adminAccess){ alert('Admin required to delete'); return; }
  if(!confirm('Delete this teacher?')) return;
  faculty.splice(i,1); persist(); renderTableFiltered();
}

/* view teacher (read-only modal) */
function openTeacherPanel(tObj, idx, readonly=false){
  // reuse modal: populate and disable inputs
  editingIndex = idx;
  openTeacherModal();
  document.getElementById('t_first').value = tObj.fname; document.getElementById('t_middle').value = tObj.mname; document.getElementById('t_last').value = tObj.lname;
  document.getElementById('t_position').value = tObj.position; document.getElementById('t_empno').value = tObj.empno; document.getElementById('t_sex').value = tObj.sex;
  document.getElementById('t_age').value = tObj.age; document.getElementById('t_contact').value = tObj.contact; document.getElementById('t_address').value = tObj.address;
  document.getElementById('t_email').value = tObj.email; document.getElementById('t_special').value = tObj.special;
  // schedule
  const list = document.getElementById('scheduleList'); list.innerHTML='';
  (tObj.schedules||[]).forEach(s=>{
    const li = document.createElement('div'); li.className='schedule-item';
    li.innerHTML = `<div>${s.day} ${s.start}-${s.end} ‚Ä¢ ${s.subject} ‚Ä¢ ${s.room}</div>`;
    list.appendChild(li);
  });
  // make inputs readonly if not admin or readonly flag
  const inputs = document.querySelectorAll('#teacherModal input, #teacherModal select, #teacherModal button');
  inputs.forEach(inp=>{
    if(inp.tagName==='BUTTON'){ /* keep Close/Save buttons handling */ }
    if(readonly || !adminAccess){
      inp.disabled = true;
    } else {
      inp.disabled = false;
    }
  });
  document.getElementById('teacherModalTitle').innerText = readonly ? 'View Teacher' : (adminAccess ? 'Edit Teacher' : 'View Teacher');
}

/* Vacant detection: find teachers who DO NOT have a schedule overlapping current datetime */
function getCurrentDayTime(){
  const now = new Date();
  // map weekday to our day strings
  const days = ['SUNDAY','MONDAY','TUESDAY','WEDNESDAY','THURSDAY','FRIDAY','SATURDAY'];
  const day = days[now.getDay()];
  const hh = String(now.getHours()).padStart(2,'0');
  const mm = String(now.getMinutes()).padStart(2,'0');
  const time = `${hh}:${mm}`;
  return {day,time};
}

/* check overlap: returns true if given time is inside start-end (inclusive start, exclusive end) */
function timeInRange(time, start, end){
  // times are "HH:MM"
  return (time >= start && time < end);
}

function getVacantTeachers(){
  const ct = getCurrentDayTime();
  const result = [];
  faculty.forEach(t=>{
    const schedulesToday = (t.schedules||[]).filter(s=> s.day === ct.day );
    // if none today => vacant
    if(schedulesToday.length === 0){ result.push({t,reason:'No schedule today'}); return; }
    // if any schedule overlaps current time then NOT vacant
    const busy = schedulesToday.some(s => timeInRange(ct.time, s.start, s.end));
    if(!busy) result.push({t,reason:'Free at this time'});
  });
  return result;
}

/* Vacant modal control */
function openVacantModal(){
  const list = document.getElementById('vacantList'); list.innerHTML='';
  const vacants = getVacantTeachers();
  if(vacants.length===0){ list.innerHTML = '<div class="small">No vacant teachers at this time.</div>'; }
  vacants.forEach(v=>{
    const div = document.createElement('div'); div.className='schedule-item';
    div.innerHTML = `<div><strong>${v.t.fname} ${v.t.lname}</strong><br><small>${v.t.position} ‚Ä¢ ${v.t.empno}</small><div class="small">Reason: ${v.reason}</div></div><div><button onclick="openTeacherFromVacant('${v.t.empno}')">View</button></div>`;
    list.appendChild(div);
  });
  document.getElementById('vacantModal').style.display='block';
}
function closeVacantModal(){ document.getElementById('vacantModal').style.display='none'; }
function openTeacherFromVacant(empno){
  closeVacantModal();
  const idx = faculty.findIndex(x=> x.empno === empno);
  if(idx>=0) viewTeacher(idx);
}

/* Schedules modal: list all teachers and their schedules */
function openSchedulesModal(){
  const el = document.getElementById('allSchedules'); el.innerHTML='';
  if(faculty.length===0){ el.innerHTML = '<div class="small">No teachers yet.</div>'; document.getElementById('schedulesModal').style.display='block'; return; }
  faculty.forEach(t=>{
    const d = document.createElement('div'); d.className='schedule-item';
    const schedText = (t.schedules||[]).map(s=> `${s.day} ${s.start}-${s.end} ‚Ä¢ ${s.subject} ‚Ä¢ ${s.room}`).join('<br>');
    d.innerHTML = `<div><strong>${t.fname} ${t.lname}</strong><br><small>${t.position} ‚Ä¢ ${t.empno}</small><div class="small">${schedText || 'No schedule'}</div></div><div><button onclick="openTeacherSchedule('${t.empno}')">View</button></div>`;
    el.appendChild(d);
  });
  document.getElementById('schedulesModal').style.display='block';
}
function closeSchedulesModal(){ document.getElementById('schedulesModal').style.display='none'; }
function openTeacherSchedule(empno){ closeSchedulesModal(); const idx = faculty.findIndex(x=> x.empno===empno); if(idx>=0) viewTeacher(idx); }

/* Export CSV (Excel-friendly) including schedules flattened */
function exportCSV(){
  if(faculty.length===0){ alert('No data to export'); return; }
  const rows = [];
  const header = ['#','FIRST','MIDDLE','LAST','POSITION','EMP_NO','SEX','AGE','ADDRESS','CONTACT','EMAIL','SPECIAL','SCHEDULES_JSON'];
  rows.push(header);
  faculty.forEach((t,i)=>{
    const schedulesJson = JSON.stringify(t.schedules || []);
    rows.push([i+1,t.fname,t.mname,t.lname,t.position,t.empno,t.sex,t.age,t.address,t.contact,t.email,t.special,schedulesJson]);
  });
  const csv = rows.map(r => r.map(c => `"${String(c||'').replace(/"/g,'""')}"`).join(',')).join('\r\n');
  const blob = new Blob(['\ufeff', csv], {type:'text/csv;charset=utf-8;'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href = url;
  const date = new Date().toISOString().split('T')[0];
  a.download = `faculty_data_${date}.csv`; a.click(); URL.revokeObjectURL(url);
}

/* Clear all data (admin only) */
function clearAllData(){
  if(!adminAccess){ alert('Admin required'); return; }
  if(!confirm('Erase ALL saved data? This cannot be undone.')) return;
  faculty = []; persist(); renderTableFiltered();
}

/* When the page loads, render */
renderTableFiltered();

/* allow modal close on background click */
document.querySelectorAll('.modal').forEach(m=>{
  m.addEventListener('click', e=>{
    if(e.target === m) m.style.display='none';
  });
});

/* keyboard: Esc closes modals */
document.addEventListener('keydown', e=>{
  if(e.key === 'Escape'){
    document.querySelectorAll('.modal').forEach(m=>m.style.display='none');
  }
});
</script>
</body>
</html>
