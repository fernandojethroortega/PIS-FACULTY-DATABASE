<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Pagudpud Integrated School - Faculty Database</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #fff8e7;
      margin: 0;
      padding: 0;
    }

    /* HEADER */
    header {
      text-align: center;
      background-color: #ffb703;
      color: #0d3b66;
      padding: 30px 0 25px;
      box-shadow: 0 3px 8px rgba(0, 0, 0, 0.2);
    }

    header img {
      width: 180px;
      height: auto;
      display: block;
      margin: 0 auto 10px;
      border-radius: 50%;
      object-fit: contain;
    }

    h1 { margin: 5px 0; font-size: 30px; font-weight: bold; }
    header p { font-size: 18px; font-weight: 500; margin:0; }

    /* SEARCH BAR */
    #searchBar {
      display: block;
      margin: 20px auto;
      padding: 10px;
      width: 50%;
      border: 2px solid #0d3b66;
      border-radius: 8px;
      font-size: 16px;
    }

    /* ACTIONS */
    .actions {
      width: 90%;
      margin: 10px auto;
      display: flex;
      gap: 10px;
      justify-content: flex-end;
    }

    .actions button {
      background-color: #0d3b66;
      color: white;
      border: none;
      padding: 8px 14px;
      border-radius: 8px;
      font-size: 14px;
      cursor: pointer;
    }

    .actions button.secondary {
      background-color: #ffb703;
      color: #0d3b66;
    }

    .actions button:hover { opacity: 0.95; }

    /* TABLE */
    table {
      width: 90%;
      margin: 6px auto 30px;
      border-collapse: collapse;
      text-align: left;
      background: #ffffff;
      box-shadow: 0 3px 8px rgba(0, 0, 0, 0.1);
    }

    th, td {
      border: 1px solid #ccc;
      padding: 10px;
      vertical-align: top;
    }

    th { background-color: #0d3b66; color: white; }
    tr:hover { background-color: #f1f1f1; }

    /* DROPDOWN DETAILS */
    .details { display: none; background-color: #f8f8f8; padding: 8px; border: 1px solid #ddd; margin-top:8px; border-radius:6px; }
    .dropdown-btn {
      background-color: #ffb703;
      color: #0d3b66;
      padding: 6px 10px;
      border-radius: 6px;
      border: none;
      cursor: pointer;
      font-size: 13px;
    }

    /* FORM POPUP */
    #overlay { display: none; position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.5); z-index: 999; }
    #addForm {
      display: none;
      width: 360px;
      background-color: #fff;
      border: 2px solid #0d3b66;
      border-radius: 10px;
      padding: 18px;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      box-shadow: 0 4px 14px rgba(0,0,0,0.35);
      z-index: 1000;
    }
    #addForm h3 { margin-top:0; color:#0d3b66; }
    #addForm input, #addForm select, #addForm textarea {
      width: 100%; padding: 8px; margin: 6px 0; border: 1px solid #ccc; border-radius: 6px;
    }
    #addForm .row { display:flex; gap:8px; }
    #addForm .row input { flex:1; }

    /* responsive */
    @media (max-width:720px) {
      #searchBar { width: 90%; }
      .actions { width: 90%; justify-content: center; }
      table { width: 98%; }
      header img { width: 120px; }
    }
  </style>
</head>
<body>

  <!-- HEADER -->
  <header>
    <img src="PIS OFFICIAL SEAL.png" alt="School Logo">
    <h1>Pagudpud Integrated School Faculty Database</h1>
    <p>City of San Fernando, La Union</p>
  </header>

  <!-- SEARCH -->
  <input type="text" id="searchBar" onkeyup="searchFaculty()" placeholder="Search teacher name, position, department, contact, or email...">

  <!-- ACTION BUTTONS -->
  <div class="actions">
    <button onclick="openForm()">Add Teacher</button>
    <button class="secondary" onclick="exportToExcel()">Export to Excel (.xls)</button>
    <button class="secondary" onclick="exportToCSV()">Export CSV</button>
  </div>

  <!-- FACULTY TABLE -->
  <table id="facultyTable">
    <thead>
      <tr>
        <th>#</th>
        <th>Name</th>
        <th>Position</th>
        <th>Department</th>
        <th>Details</th>
      </tr>
    </thead>
    <tbody>
      <!-- rows inserted dynamically -->
    </tbody>
  </table>

  <!-- POPUP FORM -->
  <div id="overlay" onclick="closeForm()"></div>
  <div id="addForm" role="dialog" aria-modal="true">
    <h3>Add New Teacher</h3>

    <input type="text" id="f_name" placeholder="Full Name *">
    <input type="text" id="f_position" placeholder="Position *">
    <input type="text" id="f_department" placeholder="Department *">
    <input type="text" id="f_contact" placeholder="Contact Number">
    <input type="email" id="f_email" placeholder="Email Address">
    <input type="text" id="f_advisory" placeholder="Advisory / Class">
    <textarea id="f_notes" placeholder="Notes (optional)" rows="3"></textarea>

    <div style="display:flex; gap:8px; justify-content:flex-end; margin-top:8px;">
      <button onclick="addTeacher()">Add</button>
      <button style="background:#ddd;color:#0d3b66;" onclick="closeForm()">Cancel</button>
    </div>
  </div>

  <script>
    // ----- Data storage: use localStorage so entries persist -----
    const STORAGE_KEY = 'pis_faculty_data_v1';
    let facultyData = loadData();

    // Sample default data if none exists
    if (!facultyData || facultyData.length === 0) {
      facultyData = [
        {
          name: "Maria Santos",
          position: "Master Teacher I",
          department: "English",
          contact: "0917-123-4567",
          email: "maria.santos@deped.gov.ph",
          advisory: "Grade 10 - English",
          notes: ""
        },
        {
          name: "Juan Dela Cruz",
          position: "Teacher III",
          department: "Science",
          contact: "0918-234-5678",
          email: "juan.delacruz@deped.gov.ph",
          advisory: "Grade 9 - Science",
          notes: ""
        }
      ];
      saveData();
    }

    // UTILS: load & save
    function loadData() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        return raw ? JSON.parse(raw) : [];
      } catch (e) {
        console.error('Error loading data', e);
        return [];
      }
    }
    function saveData() {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(facultyData));
    }

    // Render table
    function renderTable(filtered = null) {
      const tbody = document.querySelector('#facultyTable tbody');
      tbody.innerHTML = '';
      const list = filtered ?? facultyData;
      list.forEach((f, i) => {
        const row = document.createElement('tr');

        // create unique IDs for details so they remain separate
        const detailsId = 'details-' + (i + 1) + '-' + Date.now();

        row.innerHTML = `
          <td>${i + 1}</td>
          <td>${escapeHtml(f.name)}</td>
          <td>${escapeHtml(f.position)}</td>
          <td>${escapeHtml(f.department)}</td>
          <td>
            <button class="dropdown-btn" onclick="toggleDetails('${detailsId}', this)">Show Details</button>
            <div id="${detailsId}" class="details">
              <p><strong>Contact:</strong> ${escapeHtml(f.contact || '')}</p>
              <p><strong>Email:</strong> ${escapeHtml(f.email || '')}</p>
              <p><strong>Advisory:</strong> ${escapeHtml(f.advisory || '')}</p>
              <p><strong>Notes:</strong> ${escapeHtml(f.notes || '')}</p>
              <div style="margin-top:6px;">
                <button onclick="editTeacher(${i})" style="margin-right:6px;">Edit</button>
                <button onclick="deleteTeacher(${i})" style="background:#e74c3c;">Delete</button>
              </div>
            </div>
          </td>
        `;
        tbody.appendChild(row);
      });
    }

    // Escape HTML to avoid injection if user types <>
    function escapeHtml(text) {
      if (!text && text !== 0) return '';
      return String(text)
        .replaceAll('&', '&amp;')
        .replaceAll('<', '&lt;')
        .replaceAll('>', '&gt;')
        .replaceAll('"', '&quot;')
        .replaceAll("'", '&#39;');
    }

    // SEARCH
    function searchFaculty() {
      const q = document.getElementById('searchBar').value.trim().toLowerCase();
      if (!q) {
        renderTable();
        return;
      }
      const filtered = facultyData.filter(f => {
        return (f.name||'').toLowerCase().includes(q) ||
               (f.position||'').toLowerCase().includes(q) ||
               (f.department||'').toLowerCase().includes(q) ||
               (f.contact||'').toLowerCase().includes(q) ||
               (f.email||'').toLowerCase().includes(q) ||
               (f.advisory||'').toLowerCase().includes(q) ||
               (f.notes||'').toLowerCase().includes(q);
      });
      renderTable(filtered);
    }

    // TOGGLE DETAILS
    function toggleDetails(id, btn) {
      const el = document.getElementById(id);
      if (!el) return;
      if (el.style.display === 'block') {
        el.style.display = 'none';
        btn.textContent = 'Show Details';
      } else {
        el.style.display = 'block';
        btn.textContent = 'Hide Details';
      }
    }

    // OPEN/CLOSE FORM
    function openForm() {
      document.getElementById('overlay').style.display = 'block';
      document.getElementById('addForm').style.display = 'block';
      // clear inputs
      document.getElementById('f_name').value = '';
      document.getElementById('f_position').value = '';
      document.getElementById('f_department').value = '';
      document.getElementById('f_contact').value = '';
      document.getElementById('f_email').value = '';
      document.getElementById('f_advisory').value = '';
      document.getElementById('f_notes').value = '';
      // save mode
      document.getElementById('addForm').dataset.mode = 'add';
      document.getElementById('addForm').dataset.index = '';
    }

    function closeForm() {
      document.getElementById('overlay').style.display = 'none';
      document.getElementById('addForm').style.display = 'none';
    }

    // ADD TEACHER (or Save edited teacher)
    function addTeacher() {
      const name = document.getElementById('f_name').value.trim();
      const position = document.getElementById('f_position').value.trim();
      const department = document.getElementById('f_department').value.trim();
      const contact = document.getElementById('f_contact').value.trim();
      const email = document.getElementById('f_email').value.trim();
      const advisory = document.getElementById('f_advisory').value.trim();
      const notes = document.getElementById('f_notes').value.trim();

      if (!name || !position || !department) {
        alert('Please fill in at least Name, Position, and Department.');
        return;
      }

      const mode = document.getElementById('addForm').dataset.mode;
      const idx = document.getElementById('addForm').dataset.index;

      if (mode === 'edit' && idx !== '') {
        // update existing
        facultyData[idx] = { name, position, department, contact, email, advisory, notes };
      } else {
        // add new
        facultyData.push({ name, position, department, contact, email, advisory, notes });
      }

      saveData();
      renderTable();
      closeForm();
    }

    // Delete teacher
    function deleteTeacher(index) {
      if (!confirm('Delete this teacher?')) return;
      facultyData.splice(index, 1);
      saveData();
      renderTable();
    }

    // Edit teacher: fill form with data
    function editTeacher(index) {
      const f = facultyData[index];
      openForm();
      document.getElementById('f_name').value = f.name || '';
      document.getElementById('f_position').value = f.position || '';
      document.getElementById('f_department').value = f.department || '';
      document.getElementById('f_contact').value = f.contact || '';
      document.getElementById('f_email').value = f.email || '';
      document.getElementById('f_advisory').value = f.advisory || '';
      document.getElementById('f_notes').value = f.notes || '';
      document.getElementById('addForm').dataset.mode = 'edit';
      document.getElementById('addForm').dataset.index = index;
    }

    // EXPORT -> Excel (.xls) by sending an HTML table with application/vnd.ms-excel
    function exportToExcel() {
      if (facultyData.length === 0) { alert('No data to export'); return; }

      // Create an HTML table string for export
      let html = '<table><thead><tr>';
      const headers = ['#','Name','Position','Department','Contact','Email','Advisory','Notes'];
      headers.forEach(h => { html += '<th>' + h + '</th>'; });
      html += '</tr></thead><tbody>';

      facultyData.forEach((f, i) => {
        html += '<tr>';
        html += `<td>${i+1}</td>`;
        html += `<td>${escapeForExport(f.name)}</td>`;
        html += `<td>${escapeForExport(f.position)}</td>`;
        html += `<td>${escapeForExport(f.department)}</td>`;
        html += `<td>${escapeForExport(f.contact)}</td>`;
        html += `<td>${escapeForExport(f.email)}</td>`;
        html += `<td>${escapeForExport(f.advisory)}</td>`;
        html += `<td>${escapeForExport(f.notes)}</td>`;
        html += '</tr>';
      });

      html += '</tbody></table>';

      // Excel-friendly Blob
      const blob = new Blob(['\ufeff', html], { type: 'application/vnd.ms-excel' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'Faculty_Data.xls'; // .xls opens in Excel
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }

    // EXPORT -> CSV (another Excel-friendly format)
    function exportToCSV() {
      if (facultyData.length === 0) { alert('No data to export'); return; }

      const rows = [];
      rows.push(['#','Name','Position','Department','Contact','Email','Advisory','Notes']); // header

      facultyData.forEach((f, i) => {
        rows.push([
          i+1,
          f.name || '',
          f.position || '',
          f.department || '',
          f.contact || '',
          f.email || '',
          f.advisory || '',
          f.notes || ''
        ]);
      });

      // Convert to CSV string
      const csvContent = rows.map(r => r.map(c => `"${String(c).replace(/"/g,'""')}"`).join(',')).join('\r\n');
      const blob = new Blob(['\ufeff', csvContent], { type: 'text/csv;charset=utf-8;' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'Faculty_Data.csv';
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }

    // helpers for export to ensure HTML special characters don't break Excel table
    function escapeForExport(text) {
      if (text === undefined || text === null) return '';
      return String(text).replace(/&/g, '&amp;')
                         .replace(/</g, '&lt;')
                         .replace(/>/g, '&gt;')
                         .replace(/"/g, '&quot;');
    }

    // initialize
    renderTable();

    // Optional: allow pressing ESC to close form
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') closeForm();
    });

    // Expose some functions to global scope (used by inline onclick)
    window.openForm = openForm;
    window.closeForm = closeForm;
    window.addTeacher = addTeacher;
    window.searchFaculty = searchFaculty;
    window.toggleDetails = toggleDetails;
    window.editTeacher = editTeacher;
    window.deleteTeacher = deleteTeacher;
    window.exportToExcel = exportToExcel;
    window.exportToCSV = exportToCSV;

  </script>
</body>
</html>
